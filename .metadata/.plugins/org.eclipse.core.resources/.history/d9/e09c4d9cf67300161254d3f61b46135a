package com.controller;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.UUID;

import org.apache.commons.io.IOUtils;
import org.apache.log4j.Logger;
import org.apache.struts2.ServletActionContext;
import org.springframework.stereotype.Controller;

import com.opensymphony.xwork2.ActionSupport;
import com.util.Constants;

@Controller
public class UploadController{

	private File uploadify;  
    private String uploadifyFileName;  
    private String result;
    private Logger logger = Logger.getLogger(UploadController.class);
    
    public String uploadImage() throws IOException{
    	result = "";
    	//上传文件的保存路径
        String savePath = ServletActionContext.getServletContext().getRealPath("/"+ Constants.IMG_DIR);
        File folder = new File(savePath);
        if( !folder.exists() ) 
        	folder.mkdirs();
        logger.info(savePath); 
      //获取文件后缀
        String newSuffix = ""; 
        if( ( uploadifyFileName != null) && ( uploadifyFileName.length() > 0 ) )  
        {  
            int dot = uploadifyFileName.lastIndexOf(".");  
            if( dot >= 0 )   
                 newSuffix = uploadifyFileName.substring(dot);   
        }  
        //生成文件名
        String file_name = UUID.randomUUID().toString();
        String file_path = savePath + "\\" + file_name + newSuffix;
        logger.info(file_path); 
        //上传文件
        FileInputStream fis = new FileInputStream(uploadify);
        FileOutputStream fos = new FileOutputStream(file_path);

		IOUtils.copy(fis, fos);  
	    fos.flush();  
	    fos.close();  
	    fis.close(); 

	    result = file_name + newSuffix;
	    return SUCCESS;  
    }  
      
    public File getUploadify() {  
        return uploadify;  
    }
    
    public void setUploadify(File uploadify) {  
        this.uploadify = uploadify;  
    } 
    
    public String getUploadifyFileName() {  
        return uploadifyFileName;  
    }  
    
    public void setUploadifyFileName(String uploadifyFileName) {  
        this.uploadifyFileName = uploadifyFileName;  
    }

	public String getResult() {
		return result;
	}

	public void setResult(String result) {
		this.result = result;
	}
	
}
